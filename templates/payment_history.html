{% extends 'student_dashboard_base.html' %}
{% load static %}

{% block content %}
<div class="container-fluid px-4 mt-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="text-success fw-bold">Payment History</h2>
        <div>
            <a href="{% url 'export_payments_csv' %}" class="btn btn-outline-secondary btn-sm me-1">
                <i class="bi bi-filetype-csv"></i> CSV
            </a>
            <a href="{% url 'export_payments_pdf' %}" class="btn btn-outline-dark btn-sm">
                <i class="bi bi-file-earmark-pdf"></i> PDF
            </a>
        </div>
    </div>

    <div class="mb-3">
        <form method="get" class="d-flex gap-2">
            <select name="filter" class="form-select w-auto" onchange="this.form.submit()">
                <option value="all" {% if filter == 'all' %}selected{% endif %}>All</option>
                <option value="SUCCESS" {% if filter == 'SUCCESS' %}selected{% endif %}>Success</option>
                <option value="FAILED" {% if filter == 'FAILED' %}selected{% endif %}>Failed</option>
            </select>
        </form>
    </div>

    <div class="card shadow-sm border-0">
        <div class="card-body p-0">
            <table class="table table-hover text-center align-middle mb-0">
                <thead class="table-success">
                    <tr>
                        <th>Course</th>
                        <th>Amount</th>
                        <th>Tx ID</th>
                        <th>Status</th>
                        <th>Date</th>
                        <th>Invoice</th>
                    </tr>
                </thead>
                <tbody>
                    {% for payment in payments %}
                    <tr>
                        <td>
                            <a href="{% url 'course_learn' payment.course.id %}" class="text-dark fw-semibold">
                                {{ payment.course.title }}
                            </a>
                        </td>
                        <td>Rs. {{ payment.amount }}</td>
                        <td><small>{{ payment.transaction_uuid }}</small></td>
                        <td>
                            {% if payment.status == "SUCCESS" %}
                                <span class="badge bg-success">SUCCESS</span>
                            {% else %}
                                <span class="badge bg-danger">FAILED</span>
                            {% endif %}
                        </td>
                        <td>{{ payment.created_at|date:"Y-m-d H:i A" }}</td>
                        <td>
                            <a href="{% url 'download_invoice' payment.id %}" class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-download"></i> Download
                            </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-muted py-4">No payment records found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Pagination -->
    <nav class="mt-3">
        <ul class="pagination justify-content-center">
            {% if payments.has_previous %}
            <li class="page-item"><a class="page-link" href="?page={{ payments.previous_page_number }}&filter={{ filter }}">Previous</a></li>
            {% endif %}
            <li class="page-item active"><span class="page-link">{{ payments.number }}</span></li>
            {% if payments.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ payments.next_page_number }}&filter={{ filter }}">Next</a></li>
            {% endif %}
        </ul>
    </nav>

</div>
{% endblock %}
