{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{ assignment.title }} | View Assignment</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { background: #f4f4f4; font-family: "Times New Roman", serif; margin:0; }
.container { max-width: 900px; margin: 40px auto; }
.assignment-card { background: #fff; border-radius: 12px; padding: 25px; box-shadow: 0 2px 15px rgba(0,0,0,0.08); margin-bottom: 30px; }
.question-card { background: #fff; border-left: 5px solid #4f46e5; padding: 20px; border-radius: 10px; margin-bottom: 20px; transition: transform 0.2s; }
.question-card:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
textarea.form-control { border-radius: 8px; resize: vertical; }
.btn-primary, .btn-secondary { border-radius: 8px; }
.submitted-box { background-color: #d1fae5; border-left: 5px solid #10b981; padding: 20px; border-radius: 10px; margin-bottom: 30px; }
.no-questions { text-align: center; color: #6b7280; font-style: italic; }
</style>
</head>
<body>
<div class="container">

  <!-- Assignment Info -->
  <div class="assignment-card">
    <h2>{{ assignment.title }}</h2>
    {% if assignment.due_date %}
      <p><strong>Due:</strong> {{ assignment.due_date|date:"M d, Y H:i" }}</p>
    {% endif %}
    <p>{{ assignment.description }}</p>
    <p><strong>Course:</strong> {{ assignment.course.title }}</p>
  </div>

  {% if submission_exists %}
    <div class="submitted-box">
      <h5>âœ… You have already submitted this assignment.</h5>
      <p>Submitted on {{ submission.submitted_at|date:"M d, Y H:i" }}</p>
      <pre>{{ submission.content }}</pre>
      {% if submission.file %}
        <p><a href="{{ submission.file.url }}" target="_blank">Download Submitted File</a></p>
      {% endif %}
    </div>
  {% else %}
    <form method="POST" enctype="multipart/form-data">
      {% csrf_token %}
      {% if questions %}
        {% for question in questions %}
          <div class="question-card">
            <h5>Q{{ forloop.counter }}: {{ question.question_text }}</h5>

            {% if question.question_type == "true_false" %}
              <div class="form-check">
                <input class="form-check-input" type="radio" name="answer_{{ question.id }}" value="True" required>
                <label class="form-check-label">True</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="answer_{{ question.id }}" value="False" required>
                <label class="form-check-label">False</label>
              </div>

            {% elif question.question_type == "mcq" %}
              {% for option in question.option1|default_if_none:''|make_list %}
                {% comment %} Display MCQ options dynamically {% endcomment %}
              {% endfor %}
              <div class="form-check">
                <input class="form-check-input" type="radio" name="answer_{{ question.id }}" value="{{ question.option1 }}" required>
                <label class="form-check-label">{{ question.option1 }}</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="answer_{{ question.id }}" value="{{ question.option2 }}" required>
                <label class="form-check-label">{{ question.option2 }}</label>
              </div>
              {% if question.option3 %}
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="answer_{{ question.id }}" value="{{ question.option3 }}">
                  <label class="form-check-label">{{ question.option3 }}</label>
                </div>
              {% endif %}
              {% if question.option4 %}
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="answer_{{ question.id }}" value="{{ question.option4 }}">
                  <label class="form-check-label">{{ question.option4 }}</label>
                </div>
              {% endif %}

            {% elif question.question_type == "essay" %}
              <textarea name="answer_{{ question.id }}" class="form-control" rows="4" placeholder="Write your answer..." required></textarea>
              {% if question.essay_guidelines %}
                <small class="text-muted">{{ question.essay_guidelines }}</small>
              {% endif %}
            {% endif %}
          </div>
        {% endfor %}
      {% else %}
        <p class="no-questions">No questions available for this assignment.</p>
      {% endif %}

      <div class="d-flex gap-2 mb-4">
        <button type="submit" class="btn btn-primary">Submit Assignment</button>
        <a href="{% url 'pending_assignments' %}" class="btn btn-secondary">Back</a>
      </div>
    </form>
  {% endif %}

</div>
</body>
</html>
